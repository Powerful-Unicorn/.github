<!-- Template for PROJECT REPORT of CapstoneDesign 2024-2H, initially written by khyoo -->
<!-- 본 파일은 2024년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 | Dietary Restrictions을 가진 외국인들을 위한 생성형 AI를 이용한 맞춤형 한식 정보 제공 채팅 앱 서비스 FoodieBuddy
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | 11-힘찬유니콘 |
| (3) 팀 구성원 | 손민서 (2117020) : 리더, 백엔드<br> 도하연 (2117012) : 팀원, 프론트엔드<br> 정지후 (2117032) : 팀원, AI		 |
| (4) 팀 지도교수 | 이형준 교수님 |
| (5) 팀 멘토 | 이관호 / 연구원 / Samsung Advanced Institute of Technology (SAIT) |
| (6) 과제 분류 | 산학과제 |
| (6) 과제 키워드 | • Dietary restrictions (건강상의 이유, 문화적, 종교적 이유, 또는 개인적인 선호 등에 따라 특정 음식이나 영양소를 제한하는 것)<br> • 텍스트/이미지 생성형 AI<br> • 멀티모달  |
| (7) 과제 내용 요약 | FoodieBuddy는 한국에 체류하는 dietary restrictions이 있는 외국인들을 돕기 위한 채팅 기반 앱 서비스 입니다. FoodieBuddy는 언어 장벽과 낯선 한식 재료로 인한 어려움을 해결하고, 사용자의 dietary restrictions에 맞춘 맞춤형 메뉴 추천을 제공합니다. 이러한 기능을 구현하기 위해 gpt-4o를 이용하여 채팅을 진행하고 stable-diffusion3를 이용하여 한식 메뉴 이미지를 생성합니다. FoodieBuddy를 통해 식단 정보에 대한 접근성을 높이고, 사용자가 본인에게 적합한 한식 메뉴를 선택하는 과정을 더욱 쉽게 만들고자 합니다. |

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 | <br>FoodieBuddy 개발에 앞서 정의한 문제와 FoodieBuddy가 그 문제를 해결하는 방식을, **target customer**, 그들이 겪는 **문제점**, 그 문제점을 세부적으로 나눈 **sub-problems(painpoints)**, 그 sub-problems를 해결하는 **solution(기능**)의 네 단계로 나누어 정리하고자 한다. <br><br>**1. Target customer:** <br>타겟층은 dietary restrictions을 가진 한국 초기 정착 외국인들이다. 이들은 한식이 낯설고 한국어로 된 정보로의 접근이 어려운 상황에서 섭취할 수 있는 음식을 가려내야 하는 상황이다. <!--이를 바탕으로 페르소나는 프랑스 국적의 20대 여성인 소피아로 설정하였다. 소피아는 채식주의자이고 현재 교환학생으로 한국에 체류 중이다. 음식을 밖에서 사 먹어야 하는 상황이 생길 때, 재료 정보의 부족과 소통의 어려움으로 인해 음식점 선택과 메뉴 선택에 불편함을 겪고 있다. --> <br><br>**2. 문제점:** <br>Diertary restrictions을 가진 한국 초기 정착 외국인들은 한식에 관한 지식과 정보가 부족하며 한국어로 된 정보에 접근하는 것과 음식점에서 의사소통하는 것에도 어려움이 있다.<br><br>**3. Sub-problems(painpoints):** <br>  • Problem a) 번역기만으로는 한식 메뉴명을 직관적으로 이해하기 어렵다. <br>  • Problem b) 다른 문화권의 사람들에겐 "밑반찬"의 존재와 종류가 낯설 수 있다. <br>  • Problem c) dietary restrictions이라는 제약까지 가진 상황에서 한정적인 정보를 가지고 한식 메뉴를 탐색하고 선택해야 한다.<br><br>**4. Solution(기능)**:<br>  • Solution1 (problem a+c 를 해결) 메뉴판 사진 설명 기능: 발음 기호와 함께, 의역된 표현으로 메뉴명을 안내한다. 사용자의 dietary restrictions와 관련된 내용은 특히 강조하여 나타낸다. <br>  • Solution2 (problem b+c 를 해결) 밑반찬 사진 설명: 밑반찬 사진을 업로드하면 그 밑반찬에 대한 설명을 제공한다. 또한, dietary restrictions에 해당하는 재료가 들어가는지 여부에 대한 정보를 안내한다. <br>  • Solution3 (problem c 를 해결) 한식메뉴 추천: 유저의 요청과 dietary restrictions 정보를 함께 고려하여 한식 메뉴를 추천한다. 이때 추천하는 메뉴에 대한 설명과 이미지를 함께 제공한다.<br><br>  |
| (2) 기존연구와의 비교 | <br>**1. 번역기 :** <br> 구글 번역이나 파파고 등의 번역기 서비스를 이용하면, 메뉴판에 영어 설명이 적혀 있지 않아도 손쉽게 번역을 할 수 있다는 장점이 있다. 하지만, 공기밥을 ‘Air rice’ 로 글자 그대로 오역하거나, 불고기를 ‘Bulgogi’ 라고 발음 그대로 번역하는 경우가 많다는 것이 단점이다. 이를 해결하기 위해 본 프로젝트는 메뉴명을 ‘Barbequed beef’ 와 같이 의역하여 메뉴명 만으로도 무슨 재료를 사용한 음식인지 쉽게 알 수 있도록 한다. 또한, 간단한 설명을 덧붙여 추가적인 정보를 제공한다.<br><br>**2. AllergyEats :** <br> 미국 내 알레르기 친화적인 레스토랑을 안내하는 가이드 앱이다. 장점은 알레르기 및 dietary restrictions 에 맞게 검색 결과를 맞춤 설정할 수 있다는 것이다. 하지만, 미국의 일부 도시만 지원한다는 것이 단점이다. 또한, 해당 서비스는 dietary restrictions 으로 지정된 10가지 재료 안에서만 선택할 수 있다. 본 프로젝트는 AllergyEats 와 다르게 한국에서 사용할 수 있다. 또한, dietary restriction을 직접 입력하는 기능도 있어 더 많은 사용자를 포괄할 수 있다.<br><br>  |
| (3) 제안 내용 |<br> **1.** gpt-4o를 활용한 메뉴판 사진의 메뉴명 인식 및 설명 채팅 <br> **2.** gpt-4o를 활용한 밑반찬 사진 인식 및 설명 채팅<br> **3.** gpt-4o를 활용한 dietary restrictions 기반 한식 추천 채팅<br> **4.** stable-diffusion 3를 활용한 추천 메뉴 및 관심 메뉴 이미지 생성 <br><br>|
| (4) 기대효과 및 의의 | <br>한국에 정착 초기인 외국인들이 한식에 대한 정보 접근성을 크게 향상시킬 수 있다. 특히, dietary restrictions을 가진 사람들에게는 자신에게 적합한 음식을 안전하게 선택할 수 있는 도구를 제공하여 불안감을 해소하고, 메뉴 선택의 자율성을 확대해준다. 메뉴 설명과 밑반찬 정보 제공으로 인해 한국 음식 문화에 대한 이해가 높아진다. 이로써 외국인들이 한국 생활에 적응하는 과정이 더욱 원활해질 것이다. 나아가, 한식 메뉴 추천 기능을 통해 다양한 음식을 시도할 기회를 제공함으로써 외국인들이 한국 음식 문화를 즐기고 그에 대한 긍정적인 경험을 쌓도록 돕는다. 이는 결과적으로 한국 생활에 대한 진입장벽을 낮추고, 더 많은 외국인들이 한국에서의 생활에 긍정적인 인식을 가지도록 기여할 것이다.<br><br> |
| (5) 주요 기능 리스트 | <br>FoodieBuddy의 주요 기능은 총 5가지이다. 각 기능을 기능Ⓐ ~ 기능Ⓔ로 칭하며 그에 대해 기술하고자 한다. <br><br>• 기능Ⓐ 식이제한 입력 :<br> 사용자가 자신의 dietary restriction을 입력할 수 있다. 입력한 dietary restriction 정보는 데이터베이스에 저장된 후 챗봇의 프롬프트에 포함되어, 사용자는 항상 자신의 dietary restriction에 대한 고려가 포함된 챗봇 답변을 얻을 수 있다. <br><br>• 기능Ⓑ 한식 메뉴 추천 : <br>Gpt-4o가 프롬프트의 설명에 따라 단계적으로 한식 메뉴 추천을 위한 대화를 진행한다. <br>먼저, gpt-4o가어떠한 맛이 먹고싶은지 사용자에게 질문을 하고, 사용자가 답변하면,  이와 함께 dietary restrictions 정보를 함께 고려하여 메뉴를 추천한다. <br>대화 중 사용자에게 추천할 메뉴에 대해서는 stable diffusion을 통해 해당 메뉴의 이미지를 생성한다. 이때 모델의 정확도를 위해 농촌진흥청의 식재료 데이터 API를 통해 메뉴명과 식재료를 함께 프롬프트로 제공한다. <br><br>• 기능Ⓒ 메뉴판 사진 설명 : <br>메뉴판 사진을 업로드하면, gpt-4o가 사진을 인식하여, 프롬프트의 설명에 따라 단계적으로 대화를 진행한다. <br>먼저, gpt-4o가 사진 속 메뉴명을 추출하고, 각 발음 기호(Mul-naengmyeon)와 함께, 의역된 표현(Bukwheat noodles)으로 메뉴명을 안내한다. 이때, 사용자의 dietary restrictions에 포함되는 재료가 있다면, 특히 강조하여 설명한다. <br>대화 중 사용자가 궁금해하는 메뉴가 있다고 말하면, stable diffusion을 통해 해당 메뉴의 이미지를 생성한다. 이때 모델의 정확도를 위해 농촌진흥청의 식재료 데이터 API를 통해 메뉴명과 식재료를 함께 프롬프트로 제공한다. <br><br>• 기능Ⓓ 밑반찬 사진 설명 : <br>밑반찬 사진을 업로드하면 gpt-4o가 사진을 인식하여, 프롬프트의 설명에 따라 밑반찬 설명을 위한 대화를 진행한다. 이때, 사용자의 dietary restrictions에 관련한 정보를 중점적으로 안내한다. <br><br>• 기능Ⓔ 메뉴 북마크 및 별점 저장 :<br> 메뉴 추천, 메뉴판 설명, 밑반찬 설명의 과정에서 챗봇이 제공하는 음식 정보를 북마크할 수 있다. <br>채팅 화면에서 음식 정보가 보여질 때, 옆에 있는 버튼을 누르면 별도의 북마크 목록에 저장되며, 백엔드 서버로 해당 메뉴에 대한 북마크 저장 요청을 보내게 된다. <br>요청을 받은 백엔드 서버에서는, 해당 유저가 해당 메뉴에 대해 북마크를 저장한 것으로 북마크 저장 기록을 생성한다. 이렇게 저장된 북마크 기록은 북마크 목록에서 한꺼번에 확인할 수 있으며, 북마크를 삭제하거나 북마크로 저장한 각 음식에 대한 별점을 매기는 것도 이 화면에서 가능하다.<br><br>  |

<br>
 
# Project-Design
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 | <br> FoodieBuddy 앱 서비스의 주요 기능은 크게 Dietary restriction 등록 기능, 메뉴판 사진 설명 기능, 밑반찬 사진 설명 기능, 한식 메뉴 추천 기능, 메뉴 북마크 및 별점 저장 기능으로 총 5가지이다. <br> 5가지 기능에 대해 <br>**1. 기능별 상세 요구사항**에서 각 기능의 입출력 처리과정을 다루고, 이어서 <br>**2. E-R 다이어그램**을 통해 앱 서비스의 전반적인 데이터가 어떻게 연결되는지를 보이고자 한다. <br><br> **[1. 기능별 상세 요구사항]** <br> <img src="https://github.com/Powerful-Unicorn/.github/blob/e45cb985835d216fdc8fdd69fa1d83cb1df32c80/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/%E1%84%80%E1%85%B5%E1%84%82%E1%85%B3%E1%86%BC%E1%84%87%E1%85%A7%E1%86%AF%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6.png" alt="" width="1000" /> <br><br> **[2. E-R 다이어그램]**  <br>이 E-R 다이어그램은 FoodieBuddy 서비스에서 **사용자와 관련된 데이터**, 챗봇과 사용자의 **대화 기록 저장과 관련된 데이터**, **사용자가 메뉴에 대해 저장한 데이터**를 관리하기 위한 테이블 구조를 나타낸다. 이미지 아래에 이어지는 설명은 테이블들 간의 관계와 각 테이블에 저장되는 속성들이 무엇인지에 대한 내용이다. <img src="https://github.com/Powerful-Unicorn/.github/blob/ecce92596836fa94a00fb7e546fd197076334993/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/E-R%20%E1%84%83%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%A5%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%86%B7.png" alt="E-R diagram" width="1000" /><br><br>**1. `user` 테이블**<br>**설명**: 사용자의 기본 정보를 저장하는 테이블이다. 이 테이블에는 사용자의 이메일, 비밀번호, 사용자명, 종교, 식습관 정보(채식 여부, 고기, 달걀, 유제품, 해산물, 견과류, 글루텐, 과일, 채소, 기타 식이 제한 사항)가 포함된다.<br>**주요 필드**:<br>`email`, `password`, `username`: 사용자의 기본적인 정보<br>`religion`, `vegetarian`, `meat`, `egg`, `dairy`, `seafood`, `nut`, `gluten`, `fruit`, `vegetable`, `other`: 사용자의 dietary restriction과 관련된 정보<br><br>**2. `chatflow` 테이블**<br>**설명**: 사용자가 진행하는 대화 흐름을 기록하는 테이블이다. 사용자가 대화를 시작하고 완료하는 과정에 대한 정보를 저장한다. <br>**주요 필드**:<br>`chatflow_type`: 대화의 유형 (메뉴 추천, 메뉴판 인식, 반찬 사진 인식의 세 종류 존재)<br>`is_completed`: 완료된 채팅인지 여부<br>`completed_at`: (완료된 채팅인 경우) 완료된 시각<br>`user_id`: 대화를 진행한 사용자의 ID (`chatflow` 테이블은 `user` 테이블과 연결되며, 한 명의 `user`가 여러 개의 `chatflow`를 가질 수 있는 구조이다.)<br><br>**3. `user_msg` 테이블**<br>**설명**: 사용자가 보낸 메시지를 저장하는 테이블이다. <br>**주요 필드**:<br>`content`: 사용자가 보낸 메시지 내용<br>`created_at`: 메시지가 생성된 시간<br>`chatflow_id`: 메시지가 속한 chatflow의 ID (`user_msg`테이블은 `chatflow` 테이블과 연결되며, 하나의 `chatflow`에 여러 개의 `user_msg`가 연결될 수 있는 구조이다.)<br><br>**4. `chatbot_msg` 테이블**<br>**설명**: 챗봇이 보낸 메시지를 저장하는 테이블이다. <br>**주요 필드**:<br>`content`: 챗봇이 보낸 메시지 내용<br>`created_at`: 메시지가 생성된 시간<br>`user_msg_id`: 사용자의 메시지 ID (`chatbot_msg`은 `user_msg` 테이블과 연결되며, 하나의 `user_msg` 당 하나의 `chatbot_msg`가 연결되는 구조이다. 즉, 유저가 보낸 메시지 하나 당 AI가 응답 하나를 생성하는 구조이다.)<br><br>**5. `menu` 테이블**<br>**설명**: 사용자가 별점이나 북마크를 저장한 메뉴를 저장하는 테이블이다.<br>**주요 필드**:<br>`name`: 메뉴 이름<br>`pronunciation`: 메뉴 발음 정보 <br>`star`: 사용자가 이 메뉴에 대해 저장한 별점<br>`is_bookmarked`: 사용자가 이 메뉴를 북마크했는지 여부<br>`user_id`: 별점이나 북마크를 저장한 사용자의 ID (`menu` 테이블은 `user` 테이블과 연결되며, 한 명의 `user`가 여러 개의 `menu` 와 연결될 수 있는 구조이다. 즉, 한 명의 유저가 별점 및 북마크 기록을 여러 개 저장하는 기능을 위한 구조이다.) <br><br> <!-- **[API 명세서]** <br><img src="https://github.com/Powerful-Unicorn/.github/blob/82ceac4709cd5236092756d70451ce970977bc3c/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/API%20%E1%84%86%E1%85%A7%E1%86%BC%E1%84%89%E1%85%A6%E1%84%89%E1%85%A5.png" alt="" width="1000" /> --> <br> <!-- <img src="https://github.com/Powerful-Unicorn/.github/blob/2a35faf8fa6e2bbe646eb15792a813b83df4784f/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/flow%20chart/1.%20%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%8B%E1%85%B5%E1%86%AB%20%3A%20%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8B%E1%85%AE.png" alt="" width="25%" /><img src="https://github.com/Powerful-Unicorn/.github/blob/2a35faf8fa6e2bbe646eb15792a813b83df4784f/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/flow%20chart/2.%20%E1%84%87%E1%85%A1%E1%86%AB%E1%84%8E%E1%85%A1%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%89%E1%85%B5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%86%E1%85%A7%E1%86%BC%20%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8B%E1%85%AE.png" alt="" width="25%" /> <br> <img src="https://github.com/Powerful-Unicorn/.github/blob/2a35faf8fa6e2bbe646eb15792a813b83df4784f/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/flow%20chart/3.%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%20%E1%84%8E%E1%85%AE%E1%84%8E%E1%85%A5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8B%E1%85%AE.png" alt="" width="25%" /><img src="https://github.com/Powerful-Unicorn/.github/blob/2a35faf8fa6e2bbe646eb15792a813b83df4784f/1%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/flow%20chart/4.%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%91%E1%85%A1%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%89%E1%85%B5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%AE%E1%84%86%E1%85%AE%E1%86%AB%20%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8B%E1%85%AE.png" alt="" width="25%" /> <br> <img src="" alt="" width="%" /> -->   |
| (2) 전체 시스템 구성 | <br>Foodiebuddy 앱 서비스는 타겟층이 외국인인 점을 고려하여 iOS 환경에서 개발하였다. 전체 시스템 구조는 **Frontend, Backend-DB, Backend-AI** 파트로 나누어진다. **[모듈별 설명]** 과 **[기능별 설명]** 은 구조도 하단에서 이어진다. <br><br> <img src="https://github.com/Powerful-Unicorn/.github/blob/47da7b7bdf0f1ccd6728aa248b1faa10016ae511/2%EC%B0%A8%EB%B3%B4%EA%B3%A0%EC%84%9C/image/%E1%84%8C%E1%85%A5%E1%86%AB%E1%84%8E%E1%85%A6%E1%84%89%E1%85%B5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A6%E1%86%B7%20%E1%84%80%E1%85%AE%E1%84%8C%E1%85%A9%E1%84%83%E1%85%A9.png" alt="" width="1000" /> <br><br>**[모듈별 설명]** <br><br> **Frontend**는 사용자 인터페이스와 직접적인 사용자 경험을 담당한다. **Backend DB** 서버는 유저 정보 및 북마크, 별점 정보를 DB에 저장, 조회, 수정, 삭제 하는 로직을 담당한다. **Backend AI** 서버는 채팅을 중심으로 진행되는 기능에서, 챗봇의 답변 생성과 이미지 생성을 담당한다. Frontend와 Backend를 분리함으로써 개발 및 배포 과정에서의 독립성을 보장하였고, Backend를 다시 DB 서버와 AI 서버로 분리함으로써, 개발 과정의 유연성을 높이고 유지 보수를 용이하게 하였다. <br><br> **[기능별 설명]** <br><br>**기능 1️⃣) 사용자 개인의 dietary restriction 입력**<br>• 사용자가 최초로 회원가입을 하면 dietary restrictions 목록이 뜬다. 사용자는 해당 목록에서 자신의 타입을 선택한다. <br>• Dietary restriction 을 선택하면 해당 타입이 섭취하지 못하는 구체적인 식재료 목록이 다음 페이지에 표시된다. (예: ‘비건’ 타입을 선택하면 고기, 해산물, 우유 등의 식재료들이 자동으로 선택된다.) 섭취할 수 없는 다른 식재료를 추가하거나 수정할 수 있다. <br><br>**기능 2️⃣) 한식 메뉴 추천 채팅 기능**<br>• gpt가 먼저 대화를 시작한다. gpt에는 사전에 사용자가 1번 기능에서 입력했던 dietary restricitons 정보와 대화 진행 플로우에 대한 내용을 담은 프롬프트를 제공한다. <br>• gpt가 어떠한 메뉴를 먹고 싶은지 질문하면, 사용자의 취향과 상황을 메시지로 입력할 수 있다. (예: *It’s cold today. I want to eat something warm.* (오늘 날씨가 추워서 따뜻한 음식을 먹고 싶어))<br>• 이어서 gpt는 사용자의 답변과 프롬프팅에 포함된 사용자의 dietary restricitons 정보를 활용해서 ‘떡볶이’와 같은 추천메뉴를 하나 선정하여 설명한다. 이부분에서는 collaborative filtering을 추가로 구현하여, dietary restriciton이 유사한 유저끼리 묶어서 메뉴 선호의 유사도를 반영한 메뉴 추천을 진행할 예정이다.<br>• 특정 메뉴를 추천해줄 때는 해당 메세지에 대한 답변의 시작부분에 따로 표시를 해서 stable diffusion에서 이미지를 함께 생성하여 채팅화면에 함께 보여준다. 이미지를 생성할 때는 식재료 데이터 API에서 얻은 식재료 정보를 프롬프트에 포함하여 정확도를 높인다.<br>• 이후 사용자가 추천 메뉴에 대해 질문이 있으면 추가로 이에 대한 대화를 이어나가고, 추천 메뉴가 마음에 들지 않은 경우에는 gpt가 또 다른 추천 메뉴를 생성하여 위의 대화 흐름을 반복한다.<br><br>**기능 3️⃣) 메뉴판 설명 기능**<br>• 사용자가 식당에서 메뉴판을 마주하였을 때, 메뉴판을 사진 찍어 업로드한다. <br>• 사용자가 업로드한 메뉴판 사진은 gpt의 입력으로 전달되어 gpt는 *‘김치찌개, 된장찌개, 순두부찌개, …’*와 같은 메뉴명 리스트를 추출한다. 이어서 사용자가 1번 기능에서 입력했던 dietary restricitons 정보와 대화 진행 플로우에 대한 내용을 담은 프롬프트를 기반으로 gpt가 해당 리스트에 대한 설명을 생성한다. <br>• 그리고 사용자가 *‘Is Kimchi Stew spicy?*(김치찌개가 매워?)’와 같이 특정 메뉴에 대한 질문을 하면, gpt가 이에 대한 답변을 생성 하는 흐름이 반복되며 대화가 진행된다.<br>• 이때 사용자가 위의 사례에서처럼 특정 메뉴를 궁금해하면 직후의 gpt의 답변은 시작부분에 따로 표시를 해서 stable diffusion에서 이미지를 함께 생성하여 채팅화면에 함께 보여준다. 이미지를 생성할 때는 식재료 데이터 API에서 얻은 식재료 정보를 프롬프트에 포함하여 정확도를 높인다.<br>• 이후 사용자가 해당 메뉴에 대해 질문이 있으면 추가로 이에 대한 대화를 이어나가고, 해당 메뉴가 마음에 들지 않은 경우에는 gpt가 전체적인 메뉴판 설명을 다시 보여주며, 사용자가 마음에 드는 메뉴를 찾을 수 있도록 위의 대화 흐름을 반복한다.<br><br>**기능 4️⃣) 밑반찬 설명 기능**<br>• 사용자가 식당에서 밑반찬을 서빙 받았을 때, 밑반찬을 사진 찍어 업로드한다. <br>• 사용자가 찍은 사진 은 gpt의 입력으로 전달되어, 사용자가 1번 기능에서 입력했던 dietary restricitons 정보와 대화 진행 플로우에 대한 내용을 담은 프롬프트를 기반으로 gpt가 밑반찬을 설명하는 답변을 생성한다. <br>• 이어서 사용자가 밑반찬에 대한 추가적인 질문을 하면,  gpt가 이에 대한 답변을 생성한다.<br><br>**기능 5️⃣) 메뉴 북마크 및 별점 기능**<br>• 메뉴 추천, 메뉴판 설명, 밑반찬 설명의 과정에서 챗봇이 제공하는 음식 정보를 북마크할 수 있다. <br>• 채팅 화면에서 음식 정보가 보여질 때, 옆에 있는 버튼을 누르면 별도의 ‘북마크 스크린’에 목록이 저장되며, 백엔드 서버로, 해당 메뉴에 대한 북마크 저장 요청을 보내게 된다. <br>• 요청을 받은 백엔드 서버에서는, 해당 유저가 해당 메뉴에 대해 북마크를 저장한 것으로 북마크 저장 기록을 생성한다. 이렇게 저장된 북마크 기록은 북마크 스크린에서 한꺼번에 확인할 수 있으며, 북마크를 삭제하거나 북마크로 저장한 각 음식에 대한 별점을 매기는 것도 이 화면에서 가능하다. <br><br> |
| (3) 주요엔진 및 기능 설계 | <br> **[주요 모듈 설명]** <br> **• Frontend:** 이 모듈은 유저와의 직접적인 상호작용을 모두 담당한다. 주요 기능은 총 5가지로, 서비스의 기반이 되는 dietary restriction 입력, 3가지 채팅 기능들, 메뉴 북마크 및 별점 저장 기능이 있다. <br> **• Backend - DB:** 이 모듈은 DB 접근을 담당한다. DB에서는 유저의 dietary restriction, 북마크, 별점 정보, 그리고 메뉴의 이미지 및 관련 정보를 관리한다.<br> **• Backend - AI:** 이 모듈은 사용자의 메세지와 이미지를 받아 답변을 생성하는 GPT, 필요에 따라 이미지를 생성하는 Stable Diffusion을 호출하는 로직을 담당한다. 빠른 응답이 중요한 챗봇의 구현을 위해 FastAPI를 채택하며 서버를 분리하였다.<br><br><br>**[주요 기능의 데이터 흐름]**<br><!--여기에 서론?(ex: 머머머로 쪼개고 어떻게 명명했는지)있으면 조을듯? 그리고.. 사진을 여기 한번 더 넣는건..?--><br> **기능 1️⃣** (dietary restriction 입력)**에서의 데이터 흐름** <br>**1) User → FE**<br>UI에서 텍스트 입력란과 체크박스를 이용하여, 자신의 dietary restriction 정보를 입력한다. <br>**2) FE → DB서버**<br>http 통신을 통해, dieatary restriciton 정보 (json 형식의 텍스트 데이터)를 전송<br>**3) DB서버 → MySQL RDS**<br>DB서버에서, json 형식의 텍스트 데이터 → 자바 객체 형식으로 변환 후 자바 객체의 내용에 맞는 MySQL 쿼리가 생성된다. (즉, json → 자바 객체 → MySQL 테이블)<br>**4) MySQL RDS → GPT**<br>채팅 서버에서 요청시, MySQL 테이블에 존재하는 정보가, json 형식의 텍스트 데이터로 반환된다. 이를 파싱하여, gpt에게 프롬프팅의 일부로 전달한다.<br><br> **기능 2️⃣** (한식 메뉴 추천 채팅)**에서의 데이터 흐름** <br>**1) User → FE**<br>어떤 맛이나 느낌의 음식을 원하는지(예: *“spicy and warm”*)를 채팅UI를 통해 입력한다.<br>**2) FE → AI서버**<br>URI 경로 ***‘recommendation’*** 로 웹소켓 통신을 initiate한다. URI 경로의 string 값에 따라, 서버에서는 ***‘메뉴 추천’*** 플로우를 시작한다. 생성된 웹소켓 통신을 통해, 유저의 메시지(텍스트 데이터)와 GPT의 답변(텍스트 데이터)이 오고간다. 이미지 전송이 있는 경우에도 마찬가지로 웹소켓 통신을 통해 이미지(바이너리 형식으로 인코딩된 데이터)가 전달된다.<br>**3) AI서버 → GPT**<br>URI 경로의 string 값에 따라, ***‘메뉴 추천’*** 플로우에 맞는 프롬프팅(텍스트 데이터)과 사용자 메시지(텍스트 데이터)를 인자로 GPT를 호출한다. 호출된 GPT는 응답 메시지(텍스트 데이터)를 리턴한다.<br>**4) AI서버 → Stable Diffusion**<br>GPT의 응답 중 음식명(텍스트 데이터)을 파싱하여 인자로 Stable Diffusion 호출한다. 호출된 Stable Diffusion은 생성한 이미지(바이너리 형식으로 인코딩된 데이터)를 리턴한다.<br>**5) 식재료API → GPT**<br>GPT의 응답 중, 음식명(텍스트 데이터)을 파싱하여 인자로 식재료 데이터 API를 호출한다. 호출된 API는 식재료 데이터(json 형식의 텍스트 데이터)를 리턴한다. 이 json 형식의 텍스트 데이터를, 식재료 정보 위주로 파싱하여 GPT 호출 시 전달되는 프롬프팅에 포함시킨다.<br><br> **기능 3️⃣** (메뉴판 설명 채팅)**에서의 데이터 흐름** <br>**1) User → FE**<br>설명을 얻고자 하는 메뉴판의 사진을 채팅UI를 통해 전송한다. FE에서는 이미지 파일을 base64 형식으로 인코딩하여 텍스트 데이터로 변환하는 과정을 거친다.<br>**2) FE → AI서버**<br>URI 경로 ***‘askmenu’*** 로 웹소켓 통신을 initiate한다. 생성된 웹소켓 통신을 통해, 메뉴판 사진(이미지 파일을 base64로 인코딩한 텍스트 데이터)를 전송한다. URI 경로의 string 값에 따라, 서버에서는 ***‘메뉴판 설명’*** 플로우를 시작한다. 생성된 웹소켓 통신을 통해, 유저의 메시지(텍스트 데이터)와 GPT의 답변(텍스트 데이터)이 오고간다. 이미지 전송이 있는 경우에도 마찬가지로 웹소켓 통신을 통해 이미지(바이너리 형식으로 인코딩된 데이터)가 전달된다.<br>**3) AI서버 → GPT**<br>URI 경로의 string 값에 따라, ***‘메뉴판 설명’*** 플로우에 맞는 프롬프팅(텍스트 데이터)과 사용자가 보낸 메뉴판 사진(이미지 파일을 base64로 인코딩한 텍스트 데이터)를 인자로 GPT를 호출한다. 호출된 GPT는 응답 메시지(텍스트 데이터)를 리턴한다.<br>**4) AI서버 → Stable Diffusion**<br>GPT의 응답 중 음식명(텍스트 데이터)을 파싱하여 인자로 Stable Diffusion 호출한다. 호출된 Stable Diffusion은 생성한 이미지(바이너리 형식으로 인코딩된 데이터)를 리턴한다.<br>**5) 식재료API → GPT**<br>GPT의 응답 중, 음식명(텍스트 데이터)을 파싱하여 인자로 식재료 데이터 API를 호출한다. 호출된 API는 식재료 데이터(json 형식의 텍스트 데이터)를 리턴한다. 이 json 형식의 텍스트 데이터를, 식재료 정보 위주로 파싱하여 GPT 호출 시 전달되는 프롬프팅에 포함시킨다.<br><br> **기능 4️⃣** (밑반찬 설명)**에서의 데이터 흐름** <br>**1) User → FE**<br>설명을 얻고자 하는 밑반찬의 사진을 채팅UI를 통해 전송한다. FE에서는 이미지 파일을 base64 형식으로 인코딩하여 텍스트 데이터로 변환하는 과정을 거친다.<br>**2) FE → AI서버**<br>URI 경로 ***‘askdish’*** 로 웹소켓 통신을 initiate한다. 생성된 웹소켓 통신을 통해, 밑반찬 사진(이미지 파일을 base64로 인코딩한 텍스트 데이터)를 전송한다. URI 경로의 string 값에 따라, 서버에서는 ***‘밑반찬 설명’*** 플로우를 시작한다. 생성된 웹소켓 통신을 통해, 유저의 메시지(텍스트 데이터)와 GPT의 답변(텍스트 데이터)이 오고간다.<br>**3) AI서버 → GPT**<br>URI 경로의 string 값에 따라, ***‘밑반찬 설명’*** 플로우에 맞는 프롬프팅(텍스트 데이터)과 사용자가 보낸 밑반찬 사진(이미지 파일을 base64로 인코딩한 텍스트 데이터)를 인자로 GPT를 호출한다. 호출된 GPT는 응답 메시지(텍스트 데이터)를 리턴한다.<br>**4) 식재료API → GPT**<br>GPT의 응답 중, 음식명(텍스트 데이터)을 파싱하여 인자로 식재료 데이터 API를 호출한다. 호출된 API는 식재료 데이터(json 형식의 텍스트 데이터)를 리턴한다. 이 json 형식의 텍스트 데이터를, 식재료 정보 위주로 파싱하여 GPT 호출 시 전달되는 프롬프팅에 포함시킨다.<br><br> **기능 5️⃣** (메뉴 북마크 및 별점)**에서의 데이터 흐름** <br>**1) User → FE**<br>UI에서 북마크 버튼과 별점 버튼을 이용하여, 메뉴에 대한 북마크여부와 별점 개수를 입력한다.<br>**2) FE → DB서버**<br>http 통신을 통해, ‘메뉴id’, ‘북마크 여부’, ‘별점 개수’의 3가지 정보(json 형식의 텍스트 데이터)를 전송한다.<br>**3) DB서버 → MySQL RDS**<br>DB서버에서, json 형식의 텍스트 데이터 → 자바 객체 형식으로 변환 후 자바 객체의 내용에 맞는 MySQL 쿼리가 생성된다. (즉, json → 자바 객체 → MySQL 테이블)<br>**4) MySQL RDS → GPT**<br>채팅 서버에서 요청시, MySQL 테이블에 존재하는 정보가, json 형식의 텍스트 데이터로 반환된다. 유사한 dietary restriction을 가진 유저들의 북마크 및 별점 정보를, user based collaborative filtering을 적용하여 메뉴 추천에 반영할 예정이다.<br><br> |
| (4) 주요 기능의 구현 | <br>프롬프팅이 적용된 Gpt-4o와, 파인튜닝된 Stable diffusion v1.5 모델을 활용하여 구현된 2️⃣, 3️⃣, 4️⃣번 기능에 대해 상세하게 설명하고자 한다.<br><br>**모델 구현 상세 설명**<br><br>1. **Gpt-4o 프롬프팅**<br>- 대화의 흐름을 각 기능 별로 정하여, 흐름에 따라 대화를 진행하도록 프롬프트를 작성하였다. 또한 채팅 진행 중 특정 메뉴에 대한 재료 정보가 필요한 경우, 식재료 데이터 API를 통해 얻은 정보를 프롬프트에 추가한다. 실제 프롬프트 내용은 각 기능별로 내용이 다르기에, 기능별 설명에서 구체적으로 설명하고자 한다.<br><br>2. **Stable diffusion v1.5 파인튜닝**<br>- LoRA를 활용하여, 기존 모델의 가중치는 고정된 채로, 이 과제에서 구현하고자 하는 기능(한식 이미지 생성)을 더 잘할 수 있는 가중치를 추가하는 방식으로 파인튜닝을 진행하였다.<br>- 파인튜닝을 위한 데이터는 **AI hub**의 ‘**한국 이미지(음식)**’ 데이터셋을 활용하였다. 기존 데이터셋에는 150 종류의 한식이 각 약 1000장씩(총 약 150,000장) 포함되어 있었으나,  중복되는 또는 유사한 음식은 제거하였으며, 데이터 내에 잘못된 정보가(라벨링 오류) 포함되어 있었고, 파인튜닝 특성상 많은 데이터가 필요로 하지 않기에, 143종의 한식을 각 15장씩 별도로 선별하여 파인튜닝을 위한 데이터셋을 구성하였다.<br>이렇게 구성된 두가지 AI 모듈을 활용해서 각 기능이 어떻게 구현되는지 아래에서 구체적으로 설명하고자 한다.<br><br>**2️⃣ 한식 메뉴 추천 채팅 기능** **Gpt-4o 프롬프트 내용 요약 :**<br>이 프롬프트는 한식 메뉴를 추천하는 대화의 흐름으로 구성되어 있다. 사용자의 식이 제한 사항 및 사용자의 답변을 고려하여 적절한 요리를 재료 정보, 이미지와 함께 추천하는 방식으로, 아래의 단계를 따라 대화를 진행하라는 설명을 프롬프트로 작성하였다.<br><br>- **1단계: 대화 시작 및 질문**<br>- 사용자가 원하는 요리 유형을 묻고 대화를 시작한다. 사용자의 관심사를 탐색하며, 매운 맛, 순한 맛, 구수한 맛 등 사용자가 원하는 요리의 스타일을 묻는다.<br><br>- **2단계: 메뉴 추천**<br>- 사용자의 응답과 식이 제한을 바탕으로 추천할 메뉴를 결정한다.<br>- 이때, 식이제한이 유사한 다른 유저가 5️⃣번 기능에서 평가한 내용을 반영한다(구현 예정)<br>- 추천 메뉴명을 특정 표시와 함께 정해진 형식대로 출력하여 재료 검색 함수, 이미지 생성 함수 호출로 연결되도록 한다.<br><br>- **3단계: 메뉴 설명**<br>- 선택된 메뉴에 대한 설명을 제공한다. 메뉴에 대한 기본 정보, 주요 재료, 사용자의 식이 제한에 대한 정보를 포함한 형식을 사용하여 명확하게 전달한다.<br><br>- **4단계: 추가 메뉴 추천 또는 대화 종료**<br>- 사용자가 추천된 메뉴를 좋아하지 않을 경우 다시 메뉴를 추천하거나, 사용자가 좋아한 경우 대화를 마무리한다.<br><br>위의 프롬프트를 기반으로 아래와 같은 세부 기능들로 한식 메뉴 추천 채팅이 진행된다.<br>1. **추천 메뉴 생성**<br>- 프롬프트에 명시된 1단계, 2단계에 따라 추천 메뉴가 결정된다.<br><br>2. **추천 메뉴 이름 번역 및 재료 검색**<br>- 활용하는 식재료 API는 한국어로 되어있기에, 결정된 메뉴명을 gpt-4o를 별도로 사용하여 한국어로 번역을 한다.<br>- 이어서, 이 메뉴명에 대해 식재료 데이터 API에서 재료 정보를 검색한다. 검색한 내용은 추가적인 프롬프트 내용으로 Gpt-4o에 전달된다.<br><br>3. **추천 메뉴 이미지 생성**<br>- 결정된 메뉴명을 파인튜닝된 Stable diffusion 모델에 입력으로 전달하여 이미지를 생성한다.(연결 예정, 현재는 Stable diffusion 3로 대체하여 사용중)<br>- 생성된 이미지는 채팅 화면에 보여진다.<br><br>4. **추천 메뉴 설명 및 채팅 진행**<br>- **‘추천 메뉴 이름 번역 및 재료 검색'** 이후 업데이트 된 프롬프트 내용을 기반으로 추천 메뉴를 설명한다.<br>- 이어서 사용자의 반응에 따라 추천 메뉴를 다시 생성하거나, 추천 메뉴에 대한 질의 응답을 진행하는 것으로 대화가 진행된다.<br><br><br>**3️⃣ 메뉴판 설명 기능**<br><br>**Gpt-4o 프롬프트 내용 요약**<br><br>이 프롬프트는 한식 메뉴판 이미지를 입력받아 사용자의 식이 제한에 맞춰 메뉴를 설명하는 대화의 흐름으로 구성되어 있다. 사용자가 메뉴에서 선택할 수 있는 항목을 이해하고 결정할 수 있도록 재료 정보, 이미지와 함께 설명을 제공하는 방식으로, 아래의 단계에 따라 대화를 진행하라는 설명을 프롬프트로 작성하였다.<br><br>- **1단계: 메뉴판 이미지의 메뉴명 추출**<br>- 입력된 메뉴판 이미지에서 한식 메뉴명만을 추출한다.<br>- **2단계: 메뉴별 한줄 설명 제공**<br>- 추출된 메뉴명에 대하여 각 메뉴별로 한줄씩 간단하게 설명을 제공한다.<br>- **3단계: 관심 메뉴 선정**<br>- 추천 메뉴명을 특정 표시와 함께 정해진 형식대로 출력하여 재료 검색 함수, 이미지 생성 함수 호출로 연결되도록 한다.<br>- **4단계: 관심 메뉴 설명**<br>- 선택된 메뉴에 대한 설명을 제공한다. 메뉴에 대한 기본 정보, 주요 재료, 사용자의 식이 제한에 대한 정보를 포함한 형식을 사용하여 명확하게 전달한다.<br>- **5단계: 추가 설명 및 대화 종료**<br>- 사용자가 또 다른 메뉴를 묻는 경우 그 메뉴에 대해 설명하거나, 사용자가 주문하고 싶은 메뉴를 결정한 경우 대화를 마무리한다.<br>위의 프롬프트를 기반으로 아래와 같은 세부 기능들로 한식 메뉴 추천 채팅이 진행된다.<br><br>1. **메뉴판 이미지의 메뉴별 한줄 설명 제공**<br>- 프롬프트에 명시된 1단계, 2단계에 따라 간단하게 각 메뉴를 설명한다.<br>2. **관심 메뉴 이름 번역 및 재료 검색**<br>- 활용하는 식재료 API는 한국어로 되어있기에, 관심 메뉴명을 gpt-4o를 별도로 사용하여 한국어로 번역을 한다.<br>- 이어서, 이 메뉴명에 대해 식재료 데이터 API에서 재료 정보를 검색한다. 검색한 내용은 추가적인 프롬프트 내용으로 Gpt-4o에 전달된다.<br>3. **관심 메뉴 이미지 생성**<br>- 사용자의 관심 메뉴명을 파인튜닝된 Stable diffusion 모델에 입력으로 전달하여 이미지를 생성한다.(연결 예정, 현재는 Stable diffusion 3로 대체하여 사용중)<br>- 생성된 이미지는 채팅 화면에 보여진다.<br>4. **관심 메뉴 설명 및 채팅 진행**<br>- **‘관심 메뉴 이름 번역 및 재료 검색'** 이후 업데이트 된 프롬프트 내용을 기반으로 추천 메뉴를 설명한다.<br>- 이어서 사용자의 반응에 따라 또 다른 관심 메뉴에 대해 설명하거나, 관심 메뉴에 대한 질의 응답을 진행하는 것으로 대화가 진행된다.<br><br><br>4️⃣ 밑반찬 설명 기능<br><br>**Gpt-4o 프롬프트 내용 요약**<br><br>이 프롬프트는 밑반찬 이미지를 입력받아 사용자의 식이 제한에 맞춰 밑반찬을 설명하는 대화의 흐름으로 구성되어 있다. 사용자가 모르는 밑반찬을 먹을 수 있는지 판단할 수 있도록 재료 정보와 함께 설명을 제공하는 방식으로, 아래의 단계에 따라 대화를 진행하라는 설명을 프롬프트로 작성하였다.<br><br>- **1단계: 이미지의 밑반찬 이름 출력**<br>- 입력된 이미지에 보이는 밑반찬의 이름을 추출한다.<br>- 이름을 특정 표시와 함께 정해진 형식대로 출력하여 재료 검색 함수 호출로 연결되도록 한다.<br>- **2단계: 밑반찬 설명**<br>- 선택된 메뉴에 대한 설명을 제공한다. 메뉴에 대한 기본 정보, 주요 재료, 사용자의 식이 제한에 대한 정보를 포함한 형식을 사용하여 명확하게 전달한다.<br>- **3단계: 추가 설명 및 대화 종료**<br>- 이어서 사용자가 또 다른 밑반찬이 궁금한 경우 다른 밑반찬에 대해 설명하거나, 질문이 있는 경우 해당 밑반찬에 대한 질의 응답을 진행하는 것으로 대화가 진행된다.<br><br>위의 프롬프트를 기반으로 아래와 같은 세부 기능들로 한식 메뉴 추천 채팅이 진행된다.<br><br>1. **밑반찬 이름 인식**<br>- 프롬프트에 명시된 1단계에 따라 간단하게 각 메뉴를 설명한다.<br>2. **밑반찬 이름 번역 및 재료 검색**<br>- 활용하는 식재료 API는 한국어로 되어있기에, 관심 메뉴명을 gpt-4o를 별도로 사용하여 한국어로 번역을 한다.<br>- 이어서, 이 메뉴명에 대해 식재료 데이터 API에서 재료 정보를 검색한다. 검색한 내용은 추가적인 프롬프트 내용으로 Gpt-4o에 전달된다.<br>3. **밑반찬 설명 및 채팅 진행**<br>- 이어서 사용자의 반응에 따라 또 다른 밑반찬에 대해 설명하거나, 밑반찬에 대한 질의 응답을 진행하는 것으로 대화가 진행된다.<br><br> |
| (5) 기타 |  |
